---
title: "A Grammar of Graphics Approach to Managing Numerical Ties in Parallel Coordinate Plots"
author: "Denise Bradford"
date: "`r format(Sys.Date(), '%B %Y')`"
format:
  pdf:
    toc: true
    number-sections: true
    colorlinks: true
    documentclass: article
    geometry: margin=1in
    fontsize: 11pt
    include-in-header:
      text: |
        \usepackage{soul}
        \usepackage[dvipsnames]{xcolor} % colors
        \newcommand{\db}[1]{{\textcolor{Green}{#1}}}
        \newcommand{\svp}[1]{{\textcolor{RedOrange}{#1}}}
        \newcommand{\hh}[1]{{\textcolor{blue}{#1}}}
    html:
      css: edits.css
bibliography: references_summary.bib
bibliographystyle: apa
filters:
   - latex-environment
commands: [db,svp,hh]
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = FALSE, 
  message = FALSE, 
  warning = FALSE,
  fig.width = 8,
  fig.height = 5,
  dpi = 300
)

# Load required packages
library(GGally)
library(palmerpenguins)
library(tidyverse)
library(gridExtra)
library(ggpcp)
library(datasets)
library(knitr)
library(kableExtra)
library(ggforce)

source(here::here("numerical_tie_attempts/toy_example.R"))


# Set theme
theme_set(theme_bw(base_size = 11))


```

# Introduction and Motivation

<!-- This proposal outlines a systematic approach to visually distinguish tied numerical values in multidimensional datasets by employing parallel coordinate plots (PCPs).  -->
Parallel coordinate plots (PCPs), first popularized by Alfred Inselberg, are a powerful technique for investigating patterns across multiple attributes (variables) simultaneously [@inselberg2009].
PCPs assign each dimension of an $n$-dimensional dataset to a vertical axis. Each vertical axis is then positioned along one dimension,  arranged in parallel [@wegman1990]. 
Observations are drawn as polylines connecting a single point along the sequence of dimensional axes, providing a different perspective on hard-to-visualize multidimensional data that can be used to identify clusters, outliers, and other facets of a dataset. 


When multiple observations share the same value in a given dimension, their polylines perfectly overlap, creating "visual collisions." 
This masks information about the joint distribution between variables as well as the density along a single axis. 
The treatment of ties is an aspect not generally addressed in the original parallel coordinate plots of Inselberg [-@inselberg1985] and Wegman [-@wegman1990]. 

PCPs, which were canoncially used to show continuous random variables, have always had this issue, and the use of PCPs for categorical data only emphasized the problem.
Categorical parallel axis plot solutions, such as Sankey^[Sankey diagrams do not always have parallel axes, but they are visually similar and frequently use parallel axis constructions.] and Alluvial diagrams, Categorical PCPs [@pilhöfer2013], and Parallel Sets [@kosara2006] plots all developed (largely independently!) as methods for using parallel axes to represent categorical, bivariate frequency information. Variations on these plots, such as common angle plots [@hofmann2013]

Hammock plots [@schonlau2003], another type of PCP that accommodates categorical and continuous variables, shows multiple bivariate relationships using parallelograms drawn between axes, obviating the need for tie-breaking and preserving the density information. Because only bivariate relationships are shown, it is not possible to mentally reconstruct the full joint distribution using a hammock plot.

The development of Generalized PCPs (and the software implementation `ggpcp` [@vanderplas2023]) represent a major step forward in representing the full joint distribution of the data while showing individual observations. 
One innovation in the `ggpcp` package is the handling of ties in continuous variables: ties are broken and the observations are spread out within the box representing the marginal frequency of each value of the categorical variable. 
Sorting methods are implemented to distribute the tied values in a way that reduces the overall complexity of the plot, as random line-crossings can make PCPs difficult to read and interpret.

This project aims to extend the treatment of categorical variables in generalized PCPs, implementing a solution for the treatment of continuous variables which has the following properties:

- marginal density information (approximately) faithfully represented on the vertical axis
- individual lines can be visually distinguished, at least for data where the number of observations does not induce overplotting.

An immediate consequence of the second objective is that the viewer can, at least in theory, reconstruct the full joint distribution between variables from the plot. 
We will extend the method used in `ggpcp` to represent categorical data to continuous variables, modifying it to maintain the approximate scaling of the continuous variable, with slight local distortions when tied values occur.
In addition, we will develop a consistent visual representation to provide visual cues which indicate the presence of a local distortion due to tied values, while preserving the visual representation of singular values on the parallel axis.

This combination of the advantage of Hammock plots --  maintaining the marginal density information -- and generalized PCPs, which preserve individual observations and provide the ability to reconstruct the full joint distribution, will enhance GPCPs. 
Real-world data sets frequently have both categorical and numerical data, and duplicated values in either type of variable. Our extension to GPCPs will facilitate the visual representation of these data sets. 

## Categorical Variables and Ties in `ggpcp`

The `ggpcp` package currently addresses categorical ties through a combination of sorting and tie-breaking algorithms. 
The package implements hierarchical sorting through the `pcp_arrange(data, method, space)` function, which orders observations based on a hierarchical application of variable values. 
The `method` parameter determines the sequence in which variables are considered when resolving ties in the arrangement. 
The `space` parameter specifies the proportion of the y-axis dedicated to empty space between levels of categorical variables (@fig-categorical-fix).

```{r}
#| label: fig-categorical-code
#| echo: true
#| eval: false


# 1. Modular Data Pipeline (The correct Step 1, 2, 3)
# Note: 'pcp_data' is used here as a variable name for the transformed object.
pcp_data <- mtcars %>%
  mutate(across(c(cyl, am, gear, carb), as.factor)) %>%
  pcp_select(cyl, am, gear, carb) %>%     # Step 1: Reshape data
  pcp_scale(method = "uniminmax") %>%     # Step 2: Scale axes
  pcp_arrange(method="from-left")         # Step 3: Break Ties, 
                                          #         sorting from left
```

```{r}
#| label: fig-categorical-fix
#| message: false
#| echo: false
#| output-location: column
#| fig-cap: "Comparison of tie-breaking methods for categorical variables in parallel coordinate plots using mtcars data. Standard PCP (top-left) shows overlapping lines without tie-breaking. GPCP with tie-breaking but no sorting (top-right) spreads observations evenly within categories. GPCP with sorting from left (bottom-left) and from right (bottom-right) apply hierarchical sorting to minimize line crossings, with light gray boxes indicating category groupings."

library(ggpcp)
library(ggplot2)
library(dplyr)
library(patchwork)
# 1. Modular Data Pipeline (The correct Step 1, 2, 3)
# Note: 'pcp_data' is used here as a variable name for the transformed object.
pcp_data <- mtcars %>%
  mutate(across(c(cyl, am, gear, carb), as.factor)) %>%
  pcp_select(cyl, am, gear, carb) %>%           # Step 1: Reshape data
  pcp_scale(method = "uniminmax")         # Step 2: Scale axes

p0 <- pcp_data %>%
ggplot(aes_pcp()) +
  geom_pcp(aes(color = cyl), alpha = 0.6) + 
  geom_pcp_boxes(boxwidth = 0.1, fill = "white", alpha = 0.5) +
  geom_pcp_labels() +
  theme_pcp() +
  labs(title = "Standard PCP", subtitle = "No Tie Breaking") + 
  guides(color="none")


# 2. Plotting with aes_pcp()
# Use aes_pcp() to automatically map the transformed pcp_x, pcp_y, and pcp_id variables.
p2 <- pcp_data %>%
  pcp_arrange("from-left") %>% # Sort from left
  ggplot(aes_pcp()) +
  geom_pcp(aes(color = cyl), alpha = 0.6) + 
  geom_pcp_boxes(boxwidth = 0.1, fill = "white", alpha = 0.5) +
  geom_pcp_labels() +
  theme_pcp() +
  labs(title = "GPCP: Cat. Ties + Sorting", subtitle = "Sort from left") + 
  guides(color="none")


p3 <- pcp_data %>%
  pcp_arrange("from-right") %>% # Sort from right
  ggplot(aes_pcp()) +
  geom_pcp(aes(color = cyl), alpha = 0.6) + 
  geom_pcp_boxes(boxwidth = 0.1, fill = "white", alpha = 0.5) +
  geom_pcp_labels() +
  theme_pcp() +
  labs(title = "GPCP: Cat. Ties + Sorting", subtitle = "Sort from right") + 
  guides(color="none")

pcp_data2 <- mtcars %>%
  mutate(across(c( cyl, am, gear, carb), as.factor)) %>%
  pcp_select(cyl, am, gear, carb) %>%
  pcp_scale(method = "uniminmax") %>%     # Step 2: Scale axes
  pcp_arrange("from-right") %>% # Sort from right
  # This shuffles everything within category, ensuring no sorting persists
  group_by(pcp_x, pcp_level) %>%
  mutate(order = permute::shuffle(n()),
         pcp_y = pcp_y[order],
         pcp_yend = pcp_yend[order])

p1 <-  pcp_data2 %>%
  # ungroup() %>%
  # pcp_arrange_opts(method="none", .by_group = F) %>% # No sorting - overwrote pcp_arrange()
  ggplot(aes_pcp()) +
  geom_pcp(aes(color = cyl), alpha = 0.6) + 
  geom_pcp_boxes(boxwidth = 0.1, fill = "white", alpha = 0.5) +
  geom_pcp_labels() +
  theme_pcp() +
  labs(title = "GPCP: Tie Breaking", subtitle = "No sorting") + 
  guides(color="none")

p0 + p1 + p2 + p3
```


The ability to follow individual observations is key to being able to reconstruct the full joint distribution across parallel axes. 
`ggpcp` creates equally spaced points within each category that span the portion of the vertical axis dedicated to the category (preserving the marginal frequency information, which is optionally emphasized with `geom_pcp_boxes`). 
The top left plot in @fig-categorical-fix shows the PCP without this categorical tie-breaking approach. 
However, `ggpcp` goes one step further by using hierarchical sorting (from the left, right, or both) to minimize unnecessary line crossings induced by the treatment of tied categorical variables. 
The absence of the hierarchical sorting approach is emphasized in the top right plot in @fig-categorical-fix, while the bottom left and right plots show sorting from the left and right respectively. 
This hierarchical sorting approach serves as a form of "external cognition," reducing the cognitive load required to "untangle" and group crossed lines. 
The sorting also ensures that only necessary crossings^[A crossing is necessary if it is induced by the order of x-axis variables and scaled values, rather than by the treatment of categorical variables.] occur, minimizing visual clutter.

It is worthwhile to examine how a viewer would follow a line across the plot in detail, using a generalized PCP with both numeric and categorical variables to illustrate the challenges introduced when numerical ties are present.

::: {layout-ncol=3}

![The parallel axes form the structural framework of the visualization.](images/pcp_line_tracing_guide_images/figure-1.png){#fig-figure-1 width="90%"}

![The starting point is identified on the first axis with its corresponding value.](images/pcp_line_tracing_guide_images/figure-2.png){#fig-figure-2 width="90%"}

![Following the line segment uses the Gestalt principle of good continuation.](images/pcp_line_tracing_guide_images/figure-3.png){#fig-figure-3 width="90%"}

![Values are read as approximate scaled value relative to the total range.](images/pcp_line_tracing_guide_images/figure-4.png){#fig-figure-4 width="90%"}

![The complete traced path reveals the observation's values across all variables.](images/pcp_line_tracing_guide_images/figure-5.png){#fig-figure-5 width="90%"}

:::

```{r}
#| include: false

# This chunk is just to get the pdf that can be imported into Inkscape for generating the figure sequence...
my_mtcars <- mtcars %>%
  mutate(across(c(cyl, am, gear), as.factor)) %>%
  mutate(am = factor(am, levels = c(1, 0), ordered = T),
         inv_wt = -wt) 
pcp_data <- my_mtcars %>%
  pcp_select(cyl, am, mpg, qsec, inv_wt, gear, drat) %>%          
  pcp_scale(method = "uniminmax") %>%
  pcp_arrange()

p <- pcp_data %>%
  pcp_arrange("from-left") %>% # Sort from left
  ggplot(aes_pcp()) +
  geom_pcp(aes(color = cyl), alpha = 0.6) + 
  geom_pcp_boxes(boxwidth = 0.1, fill = "white", alpha = 0.5) +
  geom_pcp_labels() +
  theme_pcp() + 
  guides(color="none")
ggsave("images/pcp_orig_ggplot2.pdf", p, width=8, height=4, units="in")
```

```{r}
#| include: false
#| eval: false
#| 

# 1. Data Preparation
my_mtcars <- mtcars %>%
  mutate(across(c(cyl, am, gear), as.factor)) %>%
  mutate(am = factor(am, levels = c(1, 0), ordered = TRUE),
         inv_wt = -wt) 

pcp_data <- my_mtcars %>%
  pcp_select(cyl, am, mpg, qsec, inv_wt, gear, drat) %>%          
  pcp_scale(method = "uniminmax") %>%
  pcp_arrange()

# 2. Select exactly 6 rows to highlight
# You can slice(1:6) or select specific indices that show interesting bifurcations
highlight_lines <- pcp_data %>% 
  dplyr::slice(1:3) 

# 3. Create the Plot
pcp_data %>%
  pcp_arrange("from-left") %>% 
  ggplot(aes_pcp()) +
  # Background: All lines, heavily de-emphasized to clear the "wire-heavy" look 
  geom_pcp(aes(color = cyl), alpha = 0.05, size = 0.2) + 
  
  # THE HALO: Thicker white lines to separate the 6 traces from the background 
  geom_pcp(data = highlight_lines, 
           color = "white", 
           alpha = 0.8, 
           size = 2.5, 
           over = 0) +
  
  # THE TRACE: The 6 specific lines 
  # 'over = 0' ensures they don't merge/bundle, showing individual path splits 
  geom_pcp(data = highlight_lines, 
           aes(color = cyl), 
           alpha = 1, 
           size = 1.2, 
           over = 0) +
  
  # Structural elements: Boxes and Labels to anchor numerical ties 
  geom_pcp_boxes(boxwidth = 0.1, fill = "white", color = "gray90", alpha = 0.5) +
  geom_pcp_labels() +
  
  # Formatting
  scale_color_manual(values = c("4" = "#1f78b4", "6" = "#e31a1c", "8" = "#33a02c")) +
  theme_pcp() + 
  guides(color = "none") +
  labs(title = "Six-Path PCP Trace",
       subtitle = "Tracing specific observations to highlight multi-axis bifurcations")


```


<!-- Ideally, show the same things you've done in the 5 figures, but with a real pcp, made with real data. De-emphasize lines that you're not looking at. Show the bifurcation in the "path" when you hit a numerical tie. 

The description here is not bad but a bit simple. What we want to do is use these to lead into the problem with ties... but the stark transition between the plots is not great. Find a single plot. Use that for all of the pictures. Create it by messing with the PDF in Inkscape, which will give you much more control and allow you to save as both PDF and SVG (better for HTML slides). -->


- Step 1: Identify the Parallel Axes (@fig-figure-1).    
Begin by identifying each vertical axis in the plot. Each axis represents one variable from the dataset. The axes are typically arranged from left to right, and the order may be determined by the data analyst to highlight specific relationships or minimize visual clutter.

- Step 2: Locate the Starting Point (@fig-figure-2).    
Find the observation of interest on the leftmost axis. The vertical position indicates the scaled value of that observation for the first variable. If you are examining a highlighted or color-coded observation, look for its distinctive marker at this starting position.

- Step 3: Follow the Line Segment (@fig-figure-3).    
Trace the line segment from the starting point to its intersection with the next axis. The human visual system naturally follows smooth, continuous paths due to the Gestalt principle of good continuation, which allows viewers to perceive connected line segments as a single, piecewise continuous line, making it easier to track observations across multiple parallel axes.

- Step 4: Read Values at Intersections (@fig-figure-4).    
At each axis intersection, the vertical position of the line indicates the observation's value for that variable. Read these values to understand how the observation changes (typically, relative to the other observations) across different dimensions of the data. The slope of line segments between axes provides information about the relationship between consecutive variables for that specific observation.

- Step 5: Continue Across All Axes (@fig-figure-5).    
Repeat the tracing process for each consecutive pair of axes until reaching the rightmost axis.  By following the complete path, you obtain a comprehensive view of how that particular observation behaves across all measured variables.  The vertical positions along each axis represent scaled values that can be interpreted as quantiles when the data are appropriately transformed. This enables identification of unique characteristics, cluster membership, or outlier status.

- Step 6: Numerical Ties -- a fork in the road.    
Describe why this happens and what the problem is, showing a different line on the same chart. 

![Numerical ties cause lines to converge at a single point.](images/pcp_line_tracing_guide_images/figure-6.png){#fig-figure-6 width="90%"}

- Step 6: Ties in Numbers — A Fork in the Road (@fig-figure-6).

What was once a single point now becomes the starting point for two separate line segments that go in different directions. 
This split is a tie in numbers, which makes it hard to understand. 
The Gestalt principle of good continuation doesn't work anymore when two or more lines come from the same point on an axis. 
This makes it hard for the viewer to figure out which outgoing segment belongs to which incoming path. The visual continuity that made tracing easy in earlier steps breaks down exactly where it is needed most. 
The observer cannot tell if the original observation follows the upper branch or the lower branch of the fork unless there are more visual cues, like color coding, clear labels, or a systematic tie-breaking arrangement. 
This lack of clarity is not just an aesthetic problem; it also makes it harder to do the main analytical job of the parallel coordinate plot, which is to show patterns that would be hard to see in tabular data by following individual observations through high-dimensional space.



<!-- When multiple observations have the same value for a variable, their lines converge to a single point on that axis.  -->
<!-- This convergence creates visual clutter -->
<!-- XXX No, it doesn't create clutter.  The lines are just there, we aren't adding additional complexity, really XXX -->
<!-- and breaks the continuity needed for individual observation tracking. -->
<!-- XXX Yes, this is the problem. They also somewhat reduce the effectiveness of marginal density estimation. XXX -->

## Addressing Numerical Ties

![Comparison of standard parallel coordinate plot representation and the Even Tie Spreading Algorithm for resolving numerical ties.](images/minimal_adjustment_full.png){#fig-working-theory}

<!-- 
XXX I do not like this sketch. The goal is to maintain as much distance between numerical values as possible WHILE breaking the ties, so that the numerical scaling is approximately correct and the ties are broken. What you've done is equivalent to converting numerical variables to categorical, breaking the numerical meaning. Think of e.g. having 1980, 1980, 2000, and 2002. If you convert to a factor, the difference between 20 and 2 years is the same (Fox news style). Instead, if you have 1979.9, 1980.1, and 2000, and 2002, you approximately keep the numerical values and you can distinguish the tied values. Your sketch should represent that. XXX

This section is where things go off the rails. I don't like the way you're introducing it -- hammock plots need to come earlier, and I've largely put them there with a brief pro/con description.  -->


The ggpcp package implements a sophisticated tie-breaking algorithm for categorical variables that maintains individual observation traceability. 
The approach spaces observations evenly within categorical levels:

> "All observations are spaced out evenly. This results in a natural visualization of the marginal frequencies along each axis (additionally enhanced by the light gray boxes grouping observations in the same category) that is not as prominent in the previous three panels. The ordering of the observations within the level is such that a minimal number of line crossings occurs between the axes." (p. 11)

The algorithm achieves this through hierarchical sorting implemented in `pcp_arrange(data, method, space)`, where the `space` parameter specifies the proportion of the y-axis used for spacing between categorical levels. 
This optimization can be formalized as:

![Spacing parameters for Categorical Axis](images/spacing_diagram.png){#fig-spacing}

$$d_i = \frac{S_i - S_i^- - S_i^+}{n_i - 1}$$

where:

-   $S_i$ is the total space allocated to category $i$
-   $S_i^-$ is the spacing below category $i$
-   $S_i^+$ is the spacing above category $i$
-   $n_i$ is the number of observations in category $i$
-   $d_i$ is the optimal spacing distance between consecutive observations

--- 

\db{Updated the writing below here. As of Thursday, Jan. 22nd, 2026}

\svp{Anything below this line needs a lot of work}

A key visual difference emerges when connecting categorical to numerical variables. 
@schonlau2024 observe:

> "When many observations have the same value for a categorical and an adjacent numerical variable, the corresponding area looks like a triangle... Notice the lines/boxes between the variables hospitalizations and comorbidities in the GPCP (Figure 13) and hammock plots (Figure 2). Most of the observations are in the boxes leading from hospitalizations=0 to either comorbidities=0 or comorbidities=1. This is far more obvious in the hammock plot than in the GPCP plot." (p. 19)

![The visual proof of the perceptual trade-offs as describe regarding how data transitions between axes.](images/boxes_v_triangles.png){#fig-boxes}

When ggpcp connects categorical and numerical variables, the tie-breaking algorithms keep the triangular patterns clear (@fig-boxes). 
<!-- I think you're missing the point here, and I don't think you should focus on the triangles! The point is that we can't distinguish the observations when the numerical stuff is there. In hammock plots the marginal density is more clear than in ggpcp, but there is no reason we couldn't get that fixed in ggpcp with some intelligent tie breaking that makes the vertical axis basically a rug plot, allowing you to visually estimate density. This would *also* ensure that we could resolve individual lines across the plot -- that is, fixing the ties fixes *both* issues. -->

@schonlau2024 observes that concentration patterns—such as the flow from zero hospitalizations to low comorbidity values—are "far more obvious in the hammock plot than in the GPCP plot" precisely because hammock plots maintain constant-width boxes that make marginal densities apparent. 
The triangular narrowing that occurs in GPCPs when categorical variables meet numerical ones obscures these density patterns and makes it difficult to distinguish individual observations.
The `ggpcp` package can address both limitations through intelligent tie resolution. 
The `space` parameter controls vertical spacing, while the `method` parameter determines systematic ordering of tied values. 
When implemented effectively, these parameters transform the vertical axis into something functionally equivalent to a rug plot, allowing users to visually estimate density while simultaneously preserving the ability to trace individual observation paths across the plot. 
This dual benefit—clear marginal density representation and resolvable individual lines—emerges from the same underlying solution.

This observation suggests an opportunity to incorporate conventions from both GPCPs and hammock plots to improve the utility of generalized parallel coordinate visualizations. 
Rather than treating these as competing approaches with distinct perceptual trade-offs, thoughtful tie-breaking implementation can combine the strengths of each method.

To understand how our tie-resolution methods achieve this synthesis, it is important to recognize the perceptual and practical challenges inherent in parallel coordinate plots. 
The following section draws on evidence from the visualization literature that directly informs our design choices and evaluation plan.

# An Approach to Numerical Ties

Currently, numerical variables disrupt some of the best innovations in the GPCP approach by making it impossible to track an observation across the plot and by obscuring marginal density information through overplotting. 
The remaining two chapters of the dissertation will address the handling of ties on numerical axes and assess the utility of visual cues that can be paired with the tie breaking method to indicate that values are approximately accurate spatially and equivalent numerically.

The `ggpcp` package does not currently provide a mechanism for resolving these tied values. 
We propose `tie_spread`, an algorithm that distributes observations with identical values along the vertical axis, transforming overlapping lines into a visually resolvable spread. 
Consistent with tidyverse conventions and the tidyselect grammar, the implementation allows users to specify tie-breaking behavior selectively across axes—applying spreading to some variables while preserving exact positioning on others. 
Sensible defaults balance visual clarity against faithful representation of the underlying data, ensuring that users can immediately benefit from improved legibility without extensive parameter tuning. 
The following section details the design and implementation of this approach.


## The Problem: Overlapping Lines


## The Solution: Tie Spreading

The `tie_spread` algorithm splits up tied observations by evenly spreading them out over a small range around their original value. 
This range is set by default to balance the need for effective tie-breaking with spatial perception. 
This makes sure that separated observations stay visually grouped near their shared value while still being different enough to trace individual paths through the plot.

![Tie spreading maintains visual separation while preserving approximate positions.](images/pcp_line_tracing_guide_images/figure-7.png){#fig-figure-7 width="90%"}

## Hierarchical Sorting for Minimal Crossings

Beyond simply spreading tied values, the ggpcp package implements hierarchical sorting to minimize line crossings as in categorical tie breaking.

By ordering observations within a tie group based on their values on adjacent axes, the package leverages the Gestalt principle of common fate. 
This strategy ensures that observations with similar trajectories are positioned in close proximity, creating cohesive visual bands. 
These bands facilitate the perception of distinct groups as they move together through high-dimensional space, reducing visual noise and highlighting underlying patterns.

![Hierarchical sorting reduces line crossings, making patterns easier to perceive.](images/pcp_line_tracing_guide_images/figure-8.png){#fig-figure-8}
<!--
## Theoretical Framework: Perception-Driven Design

Effective data visualizations must be grounded in how people actually see and process information. 
This theoretical framework draws on research from cognitive psychology and visual perception to explain how viewers interpret visual displays. 
The framework covers four key areas that trace the path from seeing a visualization to understanding its meaning. 
**Stage 1** explores how Gestalt principles help viewers group visual elements into meaningful patterns. 
**Stage 2** examines how visual working memory and attention allow people to hold and manipulate information while analyzing a visualization. 
**Preattentive processing** describes how certain visual features can be detected quickly and automatically, enabling rapid visual search before focused attention is required. 
Finally, **external cognition and computational offloading** addresses how visualizations act as external aids that extend our mental capabilities by shifting some cognitive work from our minds to the visual display itself. 
These four components provide a foundation for understanding how design choices affect visualization effectiveness.


### Stage 1: Pattern Perception and Gestalt Principles

The first stage involves active pattern perception processes that segment the visual scene into coherent regions. 
The Gestalt laws of perceptual organization, articulated by German psychologists in 1912, remain fundamental principles for visualization design:

-   **Proximity:** Objects near each other are perceived as belonging together
-   **Similarity:** Objects sharing visual properties (color, shape, size) are grouped perceptually 
-   **Connectedness:** Objects connected by lines are seen as related\
-   **Continuity:** The visual system prefers interpretations with smooth, continuous paths 
-   **Symmetry:** Symmetric patterns are more easily perceived and remembered 
-   **Closure:** Incomplete shapes are perceptually completed 
-   **Common Fate:** Objects moving together are perceived as a group 
-   **Relative Size:** Smaller elements are perceived as figures against larger backgrounds


@vanderplas2023 explicitly invoke these principles in their design rationale for ggpcp:

> "By reducing the number of line crossings at non-axis points simplifies the plot, reducing the overall cognitive load required to 'untangle' (literally and metaphorically) the individual observations and leveraging the Gestalt principle of common fate." (p. 2)

The principle of **good continuation** is particularly relevant to parallel coordinate plots: can viewers smoothly follow individual lines through numerical ties, or do visual discontinuities disrupt the perceptual flow?

### Stage 2: Visual Working Memory and Attention

The second stage involves conscious attention and visual working memory, which holds only a limited number of objects (typically 3-4) for active processing. 

This three-stage model has direct implications for evaluating tie-breaking strategies:

**Equispaced Lines:**

-   Leverage preattentive orientation and position
-   Support continuous line following (good continuation)
-   Implicitly encode frequency through density (requires stage 1 processing)

**Constant-Width Boxes:**

-   Leverage preattentive size and area
-   Explicitly encode frequency (reduced cognitive load)
-   May disrupt line continuity (challenges good continuation)


## Preattentive Processing and Visual Search

A key distinction between the two approaches concerns the nature of visual search required for different analytical tasks. Ware distinguishes between:

-   **Parallel Search (Preattentive):** Target pops out immediately, search time independent of number of distractors 
-   **Serial Search (Attentive):** Search time increases linearly with number of items, requiring conscious attention

For tracing individual observations through equispaced lines, the task may benefit from preattentive processing of orientation and position. 
Each observation maintains a consistent visual identity as a continuous line with specific orientation. 
In contrast, tracing through constant-width boxes requires conscious attention to reconstruct the path, as the area-based encoding does not support preattentive line following.

However, for frequency estimation tasks, constant-width boxes may have an advantage. 
Equispaced lines require inferring frequency from density, which is a second-order visual property requiring pattern perception (stage 1).
-->

## Gestalt Principles and Line Continuity

The principle of **good continuation** states that the human visual system preferentially perceives smooth, continuous contours over interpretations requiring abrupt changes in direction. 
This principle directly impacts the effectiveness of parallel coordinate plots for tracing individual observations.

Equispaced lines maintain continuity by representing each observation as a continuous polyline extending from the leftmost to the rightmost axis. 
When observations share identical numerical values (ties), the equispacing mechanism distributes lines within each category so that they remain visually distinct without introducing discontinuities. 
The ggpcp framework implements this through hierarchical sorting, which minimizes line crossings at axis intersections and leverages both the Gestalt principle of good continuation and the principle of common fate, wherein lines with similar values across multiple axes appear to move together through the display.

Constant-width boxes represent observations as aggregated area segments rather than individual lines. 
This encoding communicates aggregate quantities effectively and provides an immediate visual representation of bivariate contingency relationships. 
However, tracing a single observation through a box requires viewers to mentally reconstruct the implied path, engaging conscious attention and working memory. 
In this sense, the two approaches serve distinct analytical purposes: equispaced lines support individual-level tracing, while boxes support aggregate-level frequency comparison.

This distinction becomes increasingly relevant as dataset size grows. 
With many observations, equispaced lines may coalesce into ribbon-like bands, yet the continuity principle still applies—viewers can perceive flow patterns even when individual lines are indistinguishable. 
Boxes, by contrast, maintain their aggregate interpretation but are not designed to preserve individual-level information. 
Rather than viewing these as competing representations, they can be understood as complementary: the line-based approach is optimal when the analytical task involves following specific cases or detecting outliers, whereas the box-based approach is optimal when the task involves comparing category frequencies or understanding distributional patterns.

# Mathematical Framework

<!--
### Introduction and Problem Statement

Parallel coordinate plots (PCPs) provide a powerful visualization technique for multivariate data, where each observation is represented as a polyline connecting values across parallel vertical axes. 
However, when multiple observations share identical values on a given axis—a condition termed *tied values*—the corresponding line segments overlap, creating visual occlusion that impedes pattern recognition and individual observation tracking.

This section presents a unified mathematical framework that extends the categorical tie-breaking approach established in generalized parallel coordinate plots [@vanderplas2023] to numerical variables, creating a single optimization framework that handles both variable types consistently.
-->

## Notation

Let $\mathcal{D}$ be a dataset with $n$ observations and $p$ variables displayed on parallel axes $X_1, X_2, \ldots, X_p$.

| Symbol | Definition |
|--------|------------|
| $x_{ij}$ | Raw value of observation $i$ on variable $j$ |
| $y_{ij}$ | Scaled value (normalized to $[0,1]$) |
| $\tilde{y}_{ij}$ | Adjusted value after tie-breaking |
| $T_j(v)$ | Set of observations tied at value $v$ on axis $j$ |
| $k$ | Number of tied observations: $k = |T_j(v)|$ |

: Core notation {#tbl-notation}

## Scaling

Variables are normalized to $[0,1]$ using min-max scaling:

$$
y_{ij} = \frac{x_{ij} - \min(X_j)}{\max(X_j) - \min(X_j)}
$$ {#eq-scaling}

## The Tie-Breaking Algorithm

### Step 1: Identify Ties

A value $v$ on axis $j$ is a tie if multiple observations share it:

$$
T_j(v) = \{i : y_{ij} = v\}, \quad \text{where } |T_j(v)| > 1
$$ {#eq-ties}

### Step 2: Compute Available Space

For a tied value $v$, find the nearest distinct neighbors above ($v^+$) and below ($v^-$):

$$
v^- = \max\{y : y < v, y \in Y_j\}, \quad v^+ = \min\{y : y > v, y \in Y_j\}
$$ {#eq-neighbors}

where $Y_j$ is the set of unique values on axis $j$.

The boundaries for spreading are midpoints to neighbors:

$$
L(v) = \frac{v + v^-}{2}, \quad U(v) = \frac{v + v^+}{2}
$$ {#eq-bounds}

If no neighbor exists, use axis limits with buffer $\beta$ (default 0.05):

- $L(v) = \max(0, v - \beta)$ if $v^-$ doesn't exist
- $U(v) = \min(1, v + \beta)$ if $v^+$ doesn't exist

The available space is:

$$
S(v) = U(v) - L(v)
$$ {#eq-space}

### Step 3: Compute Optimal Spacing

The core principle identical for categorical and numerical ties:

$$
\boxed{\Delta = \frac{S(v)}{k - 1}}
$$ {#eq-spacing}

This distributes $k$ observations evenly across the available space $S(v)$.

## Step 4: Order Observations Hierarchically

To minimize line crossings, tied observations are sorted by their positions on adjacent axes. For axis $j$, let $A_j$ be the adjacent axis (left or right depending on processing direction).

For each observation $i \in T_j(v)$, the sorting key is:

$$
\kappa_i = \tilde{y}_{i,A_j}
$$ {#eq-sortkey}

Observations are ordered so that $\kappa_{i_1} \leq \kappa_{i_2} \leq \cdots \leq \kappa_{i_k}$.

**Key insight**: This requires *sequential* axis processing—the adjusted positions from previously processed axes inform the ordering on the current axis.

### Step 5: Assign Positions

Given ordered observations $(i_1, i_2, \ldots, i_k)$:
$$
\tilde{y}_{i_m,j} = L(v) + (m - 1) \cdot \Delta, \quad m = 1, 2, \ldots, k
$$ {#eq-assign}

## Unified Framework

The algorithm treats numerical ties identically to categorical levels:

| Variable Type | Available Space | Spacing |
|--------------|-----------------|---------|
| Categorical | Box height $h_\ell$ for level $\ell$ | $\Delta = h_\ell / (n_\ell - 1)$ |
| Numerical | Midpoint boundaries $S(v)$ | $\Delta = S(v) / (k - 1)$ |

: Unified spacing principle {#tbl-unified}

Both apply the same formula: **spacing = available_space / (n − 1)**.

## Algorithm Summary

```{.pseudocode}
Algorithm: Unified Tie-Breaking

Input: Data D, variables X1...Xp, method {from-left, from-right}
Output: Adjusted positions ỹij

1. Scale all variables to [0,1]
2. Set processing order based on method
3. For each axis j in processing order:
     a. Find tied values: V = {v : |Tj(v)| > 1}
     b. For each v ∈ V:
          i.   Compute S(v) from neighbor midpoints
          ii.  Order Tj(v) by adjacent axis positions
          iii. Δ ← S(v) / (k - 1)
          iv.  Assign positions: ỹim, j = L(v) + (m-1)·Δ
4. Return adjusted data
```


## Parameters

| Parameter | Symbol | Default | Description |
|-----------|--------|---------|-------------|
| Boundary buffer | $\beta$ | 0.05 | Fallback when no neighbor exists |
| Minimum spacing | $\delta$ | 0.01 | Ensures minimum separation |
| Tie tolerance | $\varepsilon$ | $10^{-10}$ | For floating-point comparison |

: Algorithm parameters {#tbl-params}

# Implementation and Evaluation Plan

## Phase 1: Algorithm Development (Weeks 1-4)

**Deliverable:** Functional R package extension with comprehensive documentation

**Tasks:**

1.  Extend `pcp_arrange()` to detect and handle numerical ties
2.  Implement `optimize_spacing_numerical()` or `tie_spacing()` function with perceptually-motivated parameters
3.  Handle edge cases while preserving perceptual properties:

    -   Single unique value (centered position)
    -   Extreme skew (adaptive buffer sizing)
    -   Missing values (explicit separation region)
4.  Integration testing with existing ggpcp workflow

**Code Structure (Simplified):**

```{r}
optimize_spacing_numerical <- function(values, space = 0.05) {
  # 1. Identify unique values and their count
  unique_vals <- sort(unique(values))
  m <- length(unique_vals)
  
  # 2. Generate frequency table
  # Ensure it matches the sorted order of unique_vals
  freq <- as.numeric(table(values)[as.character(unique_vals)])
  
  # 3. Total available space
  # We subtract the sum of all gaps (space * (m - 1)) from the total 1.0 coordinate range
  total_gap_space <- space * (m - 1)
  available_width <- 1 - total_gap_space
  
  # 4. Proportional allocation
  # Divide the available width based on the relative frequency of each value
  widths <- (freq / sum(freq)) * available_width
  
  # 5. Calculate Positions
  # We calculate the starting point of each 'block' and then find the midpoint
  pos_midpoints <- numeric(m)
  current_pos <- 0
  
  for (i in 1:m) {
    # The midpoint is the current position plus half the width of the current block
    pos_midpoints[i] <- current_pos + (widths[i] / 2)
    
    # Advance the current position by the width of the block plus the inter-block space
    current_pos <- current_pos + widths[i] + space
  }
  
  # Return a named vector for easy lookup
  names(pos_midpoints) <- unique_vals
  return(pos_midpoints)
}
```

## Phase 2: Perceptual Validation Studies (Weeks 5–7)

**Study 1: Frequency Perception**

- **Duration:** Weeks 5–7
- **Participants:** n = 60 (30 per condition)
- **Design:** Between-subjects

**Procedure:**

1. Magnitude estimation (12 trials): "What percentage have value X?"
2. Ordinal comparison (12 trials): "Which value is more frequent?"
3. Ratio judgment (12 trials): "A is how many times B?"
4. Confidence ratings (7-point scale) for each response

**Analysis:**

- Absolute percentage error for magnitude estimation
- Accuracy rates for ordinal and ratio tasks
- Bias analysis: systematic over/under-estimation
- Confidence calibration: accuracy vs. subjective confidence

## Phase 3: Comparative Benchmarking (Weeks 6–10)

**Computational Metrics:**

1. Rendering performance (time, memory, scalability n = 2 to 100)
2. Visual quality metrics [@dennig2021]: line crossing count, ribbon overlap, visual clutter index
3. Perceptual quality estimates: modeled eye movements, predicted visual search time

**Case Studies:**

- Palmer Penguins: Mixed categorical-numerical data with known correlation structure
- Iris Dataset: Multiple numerical variables with natural ties
- Asthma Data [@schonlau2024]: Direct comparison with published hammock plot

## Phase 4: Integration and Dissemination (Weeks 8–12)

**Deliverables:**

1. **R Package Update:**
   - CRAN submission with full documentation
   - Vignette: "Handling Numerical Ties in Parallel Coordinate Plots"
   - Unit tests achieving > 95% coverage

2. **Academic Paper:**
   - Target: IEEE Transactions on Visualization and Computer Graphics
   - Submission deadline: April 2026 (IEEE VIS)

3. **Supplementary Materials:**
   - Open Science Framework repository
   - All experimental stimuli and data
   - Reproducibility package


# Expected Contributions

## Theoretical Contributions

**Unified Tie-Breaking Theory:** Formalization of equispaced optimization for both categorical and numerical variables, with key perceptual properties (separability, continuity, space efficiency)

## Practical Contributions

1. **Production Software:** Open-source R package extension immediately usable by practicing data scientists and researchers
2. **Evidence-Based Guidelines:** Design recommendations grounded in empirical evidence and perceptual theory:
   - When to use equispaced lines vs. constant-width boxes
   - How to set spacing parameters for optimal perceptual clarity
   - Task-specific visualization selection criteria
3. **Benchmark Suite:** Reusable experimental framework and stimuli for evaluating future parallel coordinate plot innovations


## Methodological Contributions

1. **Theory-Driven Evaluation:** Demonstrates how established perceptual theory (Gestalt principles) can generate specific, testable hypothesis
2. **Multi-Method Approach:** Integrates behavioral experiments with computational benchmarking to triangulate findings
3. **Reproducible Research:** Complete open science package enabling replication and extension by other researchers


# Limitations and Future Directions

## Study Limitations

- **Sample Characteristics:** University student population may not generalize to domain experts
- **Experimental Constraints:** Laboratory tasks may lack ecological validity
- **Scope:** Limited to static visualizations; interactive features not evaluated

## Future Extensions

- Longitudinal study with domain experts in real analytical workflows
- Investigation of interaction effects between individual differences and visualization method
- Hybrid approaches: smooth interpolation between lines and boxes based on dataset properties
- Integration with animation and interactive highlighting techniques

# Conclusion

This thorough examination proposal tackles a key issue in information visualization by basing design choices on how people see things. 
The suggested equispaced line method builds on ggpcp's well-known categorical tie-breaking algorithm for numerical variables. 
This creates a single framework that keeps the visual flow going, uses preattentive processing, and follows Gestalt principles of good continuation and common fate.
Equispaced lines provide distinct perceptual trade-offs relative to hammock plots' constant-width boxes: they enhance individual observation traceability and facilitate smoother visual flow, possibly at the expense of explicit frequency encoding. 

This research advances theory by illustrating how Gestalt principles and perceptual processing models formulate testable hypotheses regarding visualization effectiveness; it enhances practice by providing open-source software and evidence-based design guidelines; and it enriches methodology by showcasing theory-driven, multi-method evaluation.
To be effective, visualization must be based on how people perceive things, especially how they use Gestalt principles of proximity, similarity, continuity, and common fate to organize and make sense of visual features.
This study rigorously examines the principle by inquiring not merely "which visualization appears superior?" but rather "which visualization more effectively corresponds with perceptual organization principles for particular analytical tasks?" 

The answer, like most questions about visualization, is complicated and depends on the situation. But now it will be based on real-world data and perceptual theory.

# Appendix

## Visual Clutter and Information Density (To investigate)

Visual clutter constitutes a fundamental limitation on visualization effectiveness. 
Clutter occurs when too many visual elements compete for attention, overwhelming the viewer's capacity to extract meaningful patterns from the display.

The two approaches manage clutter through fundamentally different mechanisms. 
For equispaced lines, clutter increases with the number of observations, but hierarchical sorting minimizes line crossings and thereby reduces visual complexity. 
The approach exhibits graceful degradation: as density increases, individual lines transition perceptually into ribbons and eventually into filled areas, yet individual observations remain theoretically accessible for highlighting or interactive selection. 
For constant-width boxes, clutter depends primarily on the number of unique value combinations rather than on raw observation counts. 
Aggregation inherently reduces clutter, though at the cost of individual-level accessibility. 
The resulting display provides a clear representation of bivariate contingency relationships.

@dennig2021 formalize clutter metrics for parallel sets visualizations, measuring ribbon overlap, crossing angles, and ribbon width variance. 
These metrics can be adapted to compare the two approaches quantitatively and to guide the selection of dimension and category orderings that minimize visual complexity.



# References
